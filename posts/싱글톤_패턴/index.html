<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="싱글톤 패턴" /><meta property="og:locale" content="en" /><meta name="description" content="Bogeun’s blog for studying development. c java spring jpa computer science architecture network database operating system" /><meta property="og:description" content="Bogeun’s blog for studying development. c java spring jpa computer science architecture network database operating system" /><link rel="canonical" href="https://idiot2222.github.io/posts/%EC%8B%B1%EA%B8%80%ED%86%A4_%ED%8C%A8%ED%84%B4/" /><meta property="og:url" content="https://idiot2222.github.io/posts/%EC%8B%B1%EA%B8%80%ED%86%A4_%ED%8C%A8%ED%84%B4/" /><meta property="og:site_name" content="Bogeun" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-03-16T22:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="싱글톤 패턴" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2023-03-18T22:37:49+09:00","datePublished":"2023-03-16T22:00:00+09:00","description":"Bogeun’s blog for studying development. c java spring jpa computer science architecture network database operating system","headline":"싱글톤 패턴","mainEntityOfPage":{"@type":"WebPage","@id":"https://idiot2222.github.io/posts/%EC%8B%B1%EA%B8%80%ED%86%A4_%ED%8C%A8%ED%84%B4/"},"url":"https://idiot2222.github.io/posts/%EC%8B%B1%EA%B8%80%ED%86%A4_%ED%8C%A8%ED%84%B4/"}</script><title>싱글톤 패턴 | Bogeun</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Bogeun"><meta name="application-name" content="Bogeun"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/main/stadium.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Bogeun</a></div><div class="site-subtitle font-italic">보근의 공부 블로그</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/lectures/" class="nav-link"> <i class="fa-fw fas fa-university ml-xl-3 mr-xl-3 unloaded"></i> <span>LECTURES</span> </a><li class="nav-item"> <a href="/study/" class="nav-link"> <i class="fa-fw far fa-school fa-fw ml-xl-3 mr-xl-3 unloaded"></i> <span>STUDY</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/idiot2222" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pky2892','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>싱글톤 패턴</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>싱글톤 패턴</h1><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1685731179796135" crossorigin="anonymous"></script><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1678971600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 16, 2023 </em> </span> <span> Updated <em class="" data-ts="1679146669" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Mar 18, 2023 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/username">idiot2222</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1812 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><p><br /> <br /> <br /> <br /></p><h1 id="싱글톤-패턴이란">싱글톤 패턴이란</h1><ul><li>애플리케이션에서 어떤 클래스의 인스턴스가 단 하나만 존재해야 하는 경우이다.<ul><li>인스턴스를 단 하나만 생성해야 하고,<li>그 인스턴스에 대한 글로벌 접근을 제공해야 한다.</ul><li>싱글톤 패턴의 장점은<ul><li>모든 사용자에게 같은 같은 인스턴스 제공이 필요할 때 사용된다.<li>인스턴스를 하나만 만드니 메모리 절약이 된다.</ul></ul><p><br /> <br /> <br /> <br /></p><h1 id="가장-단순한-구현">가장 단순한 구현</h1><p>싱글톤 패턴의 필수 조건을 만족하는 단순한 구현을 알아보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">SimpleSingleton</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">SimpleSingleton</span> <span class="n">instance</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nf">SimpleSingleton</span><span class="o">()</span> <span class="o">{}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">SimpleSingleton</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleSingleton</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div><ul><li>가장 기본적인 싱글톤의 필수 조건을 둘 다 만족하는 코드이다.<ul><li>단 하나의 인스턴스만 만들어지고,<li>글로벌 접근을 제공한다.</ul></ul><p><br /> <br /></p><h2 id="하지만-이-방법은-안전할까"><span class="mr-2">하지만 이 방법은 안전할까?</span><a href="#하지만-이-방법은-안전할까" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>멀티 스레드 환경을 생각해보자.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">SimpleSingleton</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">// a</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleSingleton</span><span class="o">();</span>  <span class="c1">// b</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
<span class="o">}</span>

</pre></table></code></div></div><ul><li>1번 스레드와 2번 스레드가 있다고 할 때,<ol><li>1번 스레드가 a에 접근한다.<ul><li>어 인스턴스 없네? 만들어야겠다.</ul><li>1번 스레드가 b에, 2번 스레드는 a에 접근한다.<ul><li>1번 스레드 : 새 인스턴스를 만들어야ㅈ..<li>2번 스레드 : 어 인스턴스 없네? 만들어야겠다.</ul><li>1번 스레드 인스턴스A 생성 완료.<li>2번 스레드 인스턴스B 생성 완료.</ol><li>하나의 인스턴스만 만들어야 하는 싱글톤 패턴이 깨져버린걸 알 수 있다.</ul><p><br /> <br /> <br /> <br /></p><h1 id="쓰레드-세이프한-방법">쓰레드 세이프한 방법</h1><p>보다 안전하고 확실한 싱글톤 패턴을 위해 Thread-Safe하게 코드를 짜야한다.</p><p><br /> <br /></p><h2 id="가장-간단한-thread-safe"><span class="mr-2">가장 간단한 Thread-Safe</span><a href="#가장-간단한-thread-safe" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>synchronized 블럭을 사용해 동기화 처리한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">ThreadSafeSingleton1</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ThreadSafeSingleton1</span> <span class="n">instance</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nf">ThreadSafeSingleton1</span><span class="o">()</span> <span class="o">{}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kd">synchronized</span> <span class="nc">ThreadSafeSingleton1</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadSafeSingleton1</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div><ul><li>장점<ul><li>쉽게 구현할 수 있다.<li>확실한 Thread-Safe</ul><li>단점<ul><li>동기화 처리를 계속 해야하기 때문에 성능 저하</ul></ul><p><br /> <br /></p><h2 id="이른-초기화"><span class="mr-2">이른 초기화</span><a href="#이른-초기화" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Eager initialization으로 컴파일 시점에 그냥 바로 인스턴스를 만들어버린다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">ThreadSafeSingleton2</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ThreadSafeSingleton2</span> <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadSafeSingleton2</span><span class="o">();</span>

  <span class="kd">private</span> <span class="nf">ThreadSafeSingleton2</span><span class="o">()</span> <span class="o">{}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ThreadSafeSingleton2</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div><ul><li>장점<ul><li>단순하다.<li>확실한 Thread-Safe</ul><li>단점<ul><li>인스턴스를 미리 만드는게 단점<ul><li>메모리를 잡아먹는데 클래스마다 다르지만 부담되는 수준일 수도 있다<li>근데 아무도 안쓴다? 메모리 낭비임</ul></ul></ul><p><br /> <br /></p><h2 id="double-check-locking"><span class="mr-2">double check locking</span><a href="#double-check-locking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>인스턴스가 비었는지 두 번 체크한다.<li>인스턴스를 만드는 시점에 동기화를 때린다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">ThreadSafeSingleton3</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">volatile</span> <span class="nc">ThreadSafeSingleton3</span> <span class="n">instance</span><span class="o">;</span>

  <span class="kd">private</span> <span class="nf">ThreadSafeSingleton3</span><span class="o">()</span> <span class="o">{}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ThreadSafeSingleton3</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// a</span>
          <span class="kd">synchronized</span> <span class="o">(</span><span class="nc">ThreadSafeSingleton3</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">{</span>
              <span class="k">if</span><span class="o">(</span><span class="n">instance</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// b</span>
                  <span class="n">instance</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadSafeSingleton3</span><span class="o">();</span>
              <span class="o">}</span>
          <span class="o">}</span>
      <span class="o">}</span>

      <span class="k">return</span> <span class="n">instance</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div><ul><li>a와 b에서 볼 수 있듯이 두 번의 null 체크가 있다.<li>가장 최초의 인스턴스 생성 시점에서만 동기화가 일어나고,<ul><li>그 뒤로는 첫번째 a 체크에서 false이기 때문에 동기화가 일어날 일이 없다.</ul><li><p>해당 코드는 volatile 키워드가 도입된 jdk 1.5부터 사용이 가능하다.</p><li>장점<ul><li>동기화를 최대한 적게 할 수 있다.<li>Lazy Initialization</ul><li>단점<ul><li>volatile 키워드를 사용하니까 CPU Cache를 쓰지 못하는 것 때문에 변수 접근이 느려질 수 있다는 점</ul></ul><p><br /> <br /></p><h2 id="static-inner-class"><span class="mr-2">static inner class</span><a href="#static-inner-class" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>스태틱 이너 클래스의 특징<ul><li>본인을 감싸는 클래스(A)와 스태틱 이너 클래스(B)의 존재는 완전히 독립적이다.<ul><li>A가 생성되었다고 B가 생성되는 것이 아니고, 그 반대도 마찬가지이다.</ul><li>B가 생성되는 시점은 오직 B의 정적 필드에 대한 접근이나, 정적 메서드가 호출된 경우이다.</ul></ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">ThreadSafeSingleton4</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="nf">ThreadSafeSingleton4</span><span class="o">()</span> <span class="o">{}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">InstanceHolder</span> <span class="o">{</span>
      <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ThreadSafeSingleton4</span> <span class="no">INSTANCE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadSafeSingleton4</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="nc">ThreadSafeSingleton4</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
      <span class="k">return</span> <span class="nc">InstanceHolder</span><span class="o">.</span><span class="na">INSTANCE</span><span class="o">;</span>
  <span class="o">}</span>

<span class="o">}</span>

</pre></table></code></div></div><ul><li>장점<ul><li>Lazy Initialization<ul><li>스태틱 이너 클래스에 접근하는 시점에 생성되기 때문</ul><li>Thread-Safe<ul><li>INSTANCE는 static이기 때문에, 클래스 로딩 시점에 단 한 번만 초기화 되기 때문에 스레드 세이프할 수 있다.</ul></ul></ul><p><br /> <br /> <br /> <br /></p><h1 id="더-고려해야-할-것들">더 고려해야 할 것들</h1><p>여태 열심히 배우고 따라 구현했던 것들은 사실 사용하는 쪽에서 강제로 깰 수 있는 방법이 있다.</p><ul><li>리플렉션<li>직렬화와 역직렬화 알아보고 얘네마저 막을 수 있는 방법을 알아본다.</ul><p><br /> <br /></p><h2 id="리플렉션을-사용한-싱글톤-터치기"><span class="mr-2">리플렉션을 사용한 싱글톤 터치기</span><a href="#리플렉션을-사용한-싱글톤-터치기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>
<span class="nc">Constructor</span><span class="o">&lt;</span><span class="nc">Singleton</span><span class="o">&gt;</span> <span class="n">constructor</span> <span class="o">=</span> <span class="nc">Singleton</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredConstructor</span><span class="o">();</span>
<span class="n">constructor</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="nc">Singleton</span> <span class="n">singleton1</span> <span class="o">=</span> <span class="nc">Singleton</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="nc">Singleton</span> <span class="n">singleton2</span> <span class="o">=</span> <span class="n">constructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">singleton1</span> <span class="o">==</span> <span class="n">singleton2</span><span class="o">);</span> <span class="c1">// false</span>

</pre></table></code></div></div><ul><li>리플렉션으로 숨겨뒀던 생성자 함수를 끄집어내서 억지로 싱글톤을 깨트린 것을 볼 수 있다.</ul><p><br /> <br /></p><h3 id="리플렉션으로부터-싱글톤을-지키는-방법"><span class="mr-2">리플렉션으로부터 싱글톤을 지키는 방법</span><a href="#리플렉션으로부터-싱글톤을-지키는-방법" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">Singleton</span> <span class="o">{</span>
    <span class="no">INSTANCE</span>
<span class="o">}</span>

</pre></table></code></div></div><ul><li>열거형 클래스를 통해 방어할 수 있다.<ul><li>열거형 클래스는 리플렉션으로 생성하는게 막혀있음.</ul><li>단, 컴파일 시점에 인스턴스가 미리 만들어진다는 단점이 있다.<ul><li>또 enum의 특성상 상속을 사용할 수 없다는 점도 있다.</ul></ul><p><br /> <br /> <br /> <br /></p><h2 id="직렬화와-역직렬화로-싱글톤-깨트리기"><span class="mr-2">직렬화와 역직렬화로 싱글톤 깨트리기</span><a href="#직렬화와-역직렬화로-싱글톤-깨트리기" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">Singleton</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span> <span class="c1">// 이렇게..</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

</pre></table></code></div></div><ul><li>우선 사용하고자 하는 싱글톤 클래스에 Serializable 마커 인터페이스를 붙여줘야 한다.</ul><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>
<span class="nc">ObjectOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"test"</span><span class="o">));</span>
<span class="nc">ObjectInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"test"</span><span class="o">));</span>

<span class="nc">Singleton</span> <span class="n">singleton1</span> <span class="o">=</span> <span class="nc">Singleton</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="n">out</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">singleton1</span><span class="o">);</span>

<span class="nc">Singleton</span> <span class="n">singleton2</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Singleton</span><span class="o">)</span> <span class="n">in</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">singleton1</span> <span class="o">==</span> <span class="n">singleton2</span><span class="o">);</span>

</pre></table></code></div></div><ul><li>역직렬화 시에 생성자를 사용해서 새 객체를 만들어서 반환하기 때문에 싱글톤이 깨진다.</ul><h3 id="역직렬화-시에도-싱글톤을-지키는-방법"><span class="mr-2">역직렬화 시에도 싱글톤을 지키는 방법</span><a href="#역직렬화-시에도-싱글톤을-지키는-방법" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">Singleton</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="c1">// ...</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Singleton</span> <span class="nf">getInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// ...</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">readResolve</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">getInstance</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><ul><li>Object readResolve() 메서드를 정의해주면 해결된다.<ul><li>얘는 역직렬화 시에 어떻게 값을 전달할지 정의해줄 수 있는 메서드이다.<li><a href="https://docs.oracle.com/javase/8/docs/api/java/io/Serializable.html">참고</a></ul><li>리플렉션으로부터 싱글톤을 지켰냈던 방법인 열거형 클래스로 역직렬화 시에도 사용할 수 있다.<ul><li>enum은 기본적으로 Serializable이 붙어 있음</ul></ul><p><br /> <br /> <br /> <br /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/%EC%BD%94%EB%94%A9%EC%9C%BC%EB%A1%9C-%ED%95%99%EC%8A%B5%ED%95%98%EB%8A%94-gof%EC%9D%98-%EB%94%94%EC%9E%90%EC%9D%B8-%ED%8C%A8%ED%84%B4/'>코딩으로 학습하는 GoF의 디자인 패턴</a>, <a href='//categories/%EC%8B%B1%EA%B8%80%ED%86%A4-%ED%8C%A8%ED%84%B4/'>싱글톤_패턴</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%EC%8B%B1%EA%B8%80%ED%86%A4+%ED%8C%A8%ED%84%B4+-+Bogeun&url=https%3A%2F%2Fidiot2222.github.io%2Fposts%2F%25EC%258B%25B1%25EA%25B8%2580%25ED%2586%25A4_%25ED%258C%25A8%25ED%2584%25B4%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%EC%8B%B1%EA%B8%80%ED%86%A4+%ED%8C%A8%ED%84%B4+-+Bogeun&u=https%3A%2F%2Fidiot2222.github.io%2Fposts%2F%25EC%258B%25B1%25EA%25B8%2580%25ED%2586%25A4_%25ED%258C%25A8%25ED%2584%25B4%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fidiot2222.github.io%2Fposts%2F%25EC%258B%25B1%25EA%25B8%2580%25ED%2586%25A4_%25ED%258C%25A8%25ED%2584%25B4%2F&text=%EC%8B%B1%EA%B8%80%ED%86%A4+%ED%8C%A8%ED%84%B4+-+Bogeun" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/%EA%B8%B0%EA%B0%95_%EC%9E%90%EB%B0%94-02/">기강 자바-02</a><li><a href="/posts/%EA%B8%B0%EA%B0%95_%EC%9E%90%EB%B0%94-01/">기강 자바-01</a><li><a href="/posts/%EB%B9%84%EB%8F%99%EA%B8%B0_%EC%B2%98%EB%A6%AC/">비동기 처리</a><li><a href="/posts/%EC%8B%B1%EA%B8%80%ED%86%A4_%ED%8C%A8%ED%84%B4/">싱글톤 패턴</a><li><a href="/posts/%EC%8B%9C%ED%81%90%EB%A6%AC%ED%8B%B0_%EC%84%A4%EC%A0%95/">시큐리티 설정</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/spring-mvc/">spring-mvc</a> <a class="post-tag" href="/tags/spring-security/">spring-security</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%ED%8C%A9%ED%86%A0%EB%A6%AC_%EB%A9%94%EC%84%9C%EB%93%9C_%ED%8C%A8%ED%84%B4/"><div class="card-body"> <em class="small" data-ts="1679216400" data-df="ll" > Mar 19, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>팩토리 메서드 패턴</h3><div class="text-muted small"><p> 팩토리 메서드 패턴이란 구체적으로 어떤 인스턴스를 만들 것인가를 서브 클래스가 정하도록 하는 방법이다. 객체 생성에 대한 책임을 서브 클래스에게 넘긴다. 클라이언트 코드에서는 객체 생성을 위한 인터페이스만 알고 있으면 된다. 객체 생성에 대한 코드가 유연해진다. 객체 생성에 대...</p></div></div></a></div><div class="card"> <a href="/posts/%EC%B6%94%EC%83%81_%ED%8C%A9%ED%86%A0%EB%A6%AC_%ED%8C%A8%ED%84%B4/"><div class="card-body"> <em class="small" data-ts="1679317200" data-df="ll" > Mar 20, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>추상 팩토리 패턴</h3><div class="text-muted small"><p> 추상 팩토리 패턴이란 아무리 봐도 팩토리 메서드 패턴이랑 뭐가 다른지 모르겠음; 얘는 나중에 이해하면 추가함;</p></div></div></a></div><div class="card"> <a href="/posts/%EB%B9%8C%EB%8D%94_%ED%8C%A8%ED%84%B4/"><div class="card-body"> <em class="small" data-ts="1679490000" data-df="ll" > Mar 22, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>빌더 패턴</h3><div class="text-muted small"><p> 빌더 패턴이란 다양한 방법의 객체 생성 및 초기화 방법을 단순하고 유연하게 구현할 수 있도록 해주는 생성 패턴이다. 복잡한 객체의 생성을 차근차근 단계적으로 만들 수 있도록 해준다. 빌더 패턴은 세 가지로 구성된다. 빌더 인터페이스 객체 생성에 필요한 단계를 정의하는 인터페이...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="//posts/%EB%94%94%EC%9E%90%EC%9D%B8_%ED%8C%A8%ED%84%B4%EC%9D%B4%EB%9E%80/" class="btn btn-outline-primary" prompt="Older"><p>디자인 패턴이란</p></a> <a href="//posts/%ED%8C%A9%ED%86%A0%EB%A6%AC_%EB%A9%94%EC%84%9C%EB%93%9C_%ED%8C%A8%ED%84%B4/" class="btn btn-outline-primary" prompt="Newer"><p>팩토리 메서드 패턴</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/username">idiot2222</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cs/">cs</a> <a class="post-tag" href="/tags/network/">network</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/devops/">devops</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/os/">os</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/spring-mvc/">spring-mvc</a> <a class="post-tag" href="/tags/spring-security/">spring-security</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
